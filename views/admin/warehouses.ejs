<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý kho - 2FATE Motor</title>

    <!-- Đồng bộ với admin dashboard -->
    <link rel="stylesheet" href="/css/admin.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <link rel="stylesheet" href="/css/css_admin/warehouses.css">
</head>

<body>

    <!-- Header -->
    <%- include('../partials/header_admin') %>

        <div class="container-fluid">
            <div class="row">

                <!-- Sidebar -->
                <%- include('../partials/sidebar_admin') %>

                    <!-- Main content -->
                    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 mt-4">

                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h1 class="text-primary">
                                <i class="bi bi-building"></i> Danh sách kho
                            </h1>

                            <button class="btn btn-primary shadow-sm" data-bs-toggle="modal"
                                data-bs-target="#addWarehouseModal">
                                <i class="bi bi-plus-circle"></i> Thêm kho mới
                            </button>
                        </div>

                        <% if (warehouses.length===0) { %>
                            <div class="alert alert-info shadow-sm border-0">
                                <i class="bi bi-info-circle"></i> Chưa có kho nào. Hãy thêm kho mới!
                            </div>

                            <% } else { %>

                                <% warehouses.forEach(warehouse=> { %>

                                    <div class="card shadow-sm border-0 p-4 mb-4 warehouse-card">

                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h5 class="m-0">
                                                <i class="bi bi-building text-primary"></i>
                                                <%= warehouse.name %>
                                            </h5>

                                            <span class="badge 
                                    <%= warehouse.status === 'active' ? 'bg-success' : 'bg-secondary' %>">
                                                <%= warehouse.status==='active' ? 'Hoạt động' : 'Ngừng hoạt động' %>
                                            </span>
                                        </div>

                                        <div class="row">

                                            <div class="col-md-6 mb-3">
                                                <div class="d-flex align-items-start">
                                                    <i class="bi bi-geo-alt-fill fs-4 text-danger me-3"></i>
                                                    <div>
                                                        <div class="text-muted small">Địa chỉ</div>
                                                        <div class="fw-semibold">
                                                            <%= warehouse.address %>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-6 mb-3">
                                                <div class="d-flex align-items-start">
                                                    <i class="bi bi-telephone-fill fs-4 text-primary me-3"></i>
                                                    <div>
                                                        <div class="text-muted small">Điện thoại</div>
                                                        <div class="fw-semibold">
                                                            <%= warehouse.phone || 'Chưa có' %>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-6 mb-3">
                                                <div class="d-flex align-items-start">
                                                    <i class="bi bi-box fs-4 text-warning me-3"></i>
                                                    <div>
                                                        <div class="text-muted small">Số loại sản phẩm</div>
                                                        <div class="fw-semibold">
                                                            <%= warehouse.product_count || 0 %>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-6 mb-3">
                                                <div class="d-flex align-items-start">
                                                    <i class="bi bi-boxes fs-4 text-success me-3"></i>
                                                    <div>
                                                        <div class="text-muted small">Tổng số lượng</div>
                                                        <div class="fw-semibold">
                                                            <%= warehouse.total_quantity || 0 %>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="pt-3 border-top text-end">
                                            <a href="/admin/warehouses/<%= warehouse.id %>/inventory"
                                                class="btn btn-primary btn-sm shadow-sm">
                                                <i class="bi bi-eye"></i> Xem tồn kho
                                            </a>
                                        </div>

                                    </div>

                                    <% }) %>

                                        <% } %>

                    </main>
            </div>
        </div>

        <!-- Modal thêm kho -->
        <div class="modal fade" id="addWarehouseModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="bi bi-plus-circle"></i> Thêm kho mới
                        </h5>
                        <button class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body">
                        <form id="addWarehouseForm">
                            <div class="mb-3">
                                <label class="form-label">Tên kho <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" name="name" required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Địa chỉ <span class="text-danger">*</span></label>
                                <textarea class="form-control" name="address" rows="3" required></textarea>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Số điện thoại</label>
                                <input type="tel" class="form-control" name="phone">
                            </div>
                        </form>
                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button class="btn btn-primary" onclick="submitAddWarehouse()">
                            <i class="bi bi-check-circle"></i> Thêm kho
                        </button>
                    </div>

                </div>
            </div>
        </div>


        <!-- JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <script>
            async function submitAddWarehouse() {
                const form = document.getElementById('addWarehouseForm');
                const formData = new FormData(form);

                const data = {
                    name: formData.get('name'),
                    address: formData.get('address'),
                    phone: formData.get('phone')
                };

                try {
                    const response = await fetch('/admin/warehouses/add', {
                        method: 'POST',
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (result.success) {
                        alert('✅ Thêm kho thành công!');
                        location.reload();
                    } else {
                        alert('❌ ' + result.message);
                    }

                } catch (err) {
                    alert('❌ Lỗi kết nối!');
                    console.error(err);
                }
            }
        </script>

</body>

</html>